DECLARE @DB_USers TABLE
(DBNames sysname, UserName sysname, LoginType sysname, AssociatedRole varchar(max),create_date datetime,modify_date datetime)
INSERT @DB_USers
EXEC SP_MSforeachdb
'
use [?]
SELECT ''?'' AS DB_Name,
case prin.name when ''dbo'' then prin.name + '' (''+ (select SUSER_SNAME(owner_sid) from master.sys.databases where name =''?'') + '')'' else prin.name end AS UserName,
prin.type_desc AS LoginType,
isnull(USER_NAME(mem.role_principal_id),'''') AS AssociatedRole ,create_date,modify_date
FROM sys.database_principals prin
LEFT OUTER JOIN sys.database_role_members mem ON prin.principal_id=mem.member_principal_id
WHERE prin.sid IS NOT NULL and prin.sid NOT IN (0x00) and
prin.is_fixed_role <> 1 AND prin.name not in (''public'',''dbo'')
AND prin.name NOT LIKE ''##%'''

SELECT
'LVDC' as Datacenter
,@@SERVERNAME as Instance
,dp.name as [LoginName]
,dp.[type_desc] as [LoginType]
,pb.name as [ServerRoleName]
,sl.is_policy_checked as [Password_PolicyChecked]
,sl.is_expiration_checked as [Password_ExpiryChecked]
,dp.is_disabled as [LoginDisabled]
,LOGINPROPERTY(dp.name, 'PasswordLastSetTime') AS [PasswordLastSetTime]
, [DBNames]
,[UserName],
STUFF(
(
SELECT ',' + CONVERT(VARCHAR(500),associatedrole)
FROM @DB_USers user2
WHERE user1.DBNames=user2.DBNames AND user1.UserName=user2.UserName
FOR XML PATH('')
),1,1,'') AS UserPermissions,
dp.create_date as [LoginCreateDate], sqll.accdate as [LastAccessDate]
FROM @DB_USers user1
right join sys.server_principals dp on dp.name = user1.UserName 
left join sys.server_role_members rm on dp.principal_id = rm.member_principal_id
LEFT join sys.server_principals pb on rm.role_principal_id = pb.principal_id
LEFT join sys.sql_logins sl on dp.principal_id = sl.principal_id 
LEFT join sys.syslogins sqll on dp.name =sqll.name 
where dp.name not like '%##%' and dp.type_desc not in ('SERVER_ROLE')
--and pb.name ='sysadmin'
GROUP BY
dp.name,pb.name,DBNames,sl.is_policy_checked,dp.is_disabled,sl.is_expiration_checked,username ,logintype,dp.create_date,sqll.accdate,dp.[type_desc] 
ORDER BY LoginName,DBNames,username